<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>영역별 MAX 기준 자동 스케일링 예시 (HTML/CSS/JS)</title>
    <style>
        :root {
            --row-h: 28px;
            --gap: 10px;
            --label-w: 140px;
            --bar-bg: #f3f4f6;
            --bar-fill: #6366f1;
            /* 보라 계열 */
            --bar-fill-2: #10b981;
            /* 초록 계열(예: 부정/긍정 구분용) */
            --text: #111827;
            --muted: #6b7280;
            --radius: 12px;
        }

        body {
            font-family: system-ui, Pretendard, Apple SD Gothic Neo, Segoe UI, sans-serif;
            color: var(--text);
            margin: 24px;
        }

        h2 {
            margin: 28px 0 8px;
            font-size: 18px;
        }

        .chart {
            max-width: 880px;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 16px;
            background: white;
        }

        .row {
            display: flex;
            align-items: center;
            gap: var(--gap);
            margin: 8px 0;
        }

        .label {
            width: var(--label-w);
            font-size: 14px;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .track {
            position: relative;
            flex: 1;
            height: var(--row-h);
            background: var(--bar-bg);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .bar {
            position: absolute;
            inset: 0 auto 0 0;
            width: 0%;
            height: 100%;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            padding-left: 12px;
            box-sizing: border-box;
            color: #fff;
            font-weight: 600;
        }

        .bar .val {
            font-size: 13px;
        }

        .right-val {
            width: 64px;
            text-align: right;
            font-variant-numeric: tabular-nums;
            color: var(--muted);
        }

        .empty {
            padding: 12px;
            color: var(--muted);
            font-size: 14px;
        }

        .footnote {
            margin-top: 8px;
            color: var(--muted);
            font-size: 12px;
        }

        /* 예시로 차트별 색상 */
        .chart[data-variant="pos"] .bar {
            background: var(--bar-fill);
        }

        .chart[data-variant="neg"] .bar {
            background: var(--bar-fill-2);
        }
    </style>
</head>

<body>

    <h2>긍정 키워드 (영역별 MAX 기준 자동 스케일링)</h2>
    <div class="chart" data-variant="pos" id="chart-pos">
        <!-- data-value 는 "퍼센트 수치"를 숫자로 넣어주세요 (예: 1.3 = 1.3%) -->
        <div class="row" data-name="소재">
            <div class="label">소재</div>
            <div class="track">
                <div class="bar" data-value="0.5"><span class="val"></span></div>
            </div>
            <div class="right-val"></div>
        </div>
        <div class="row" data-name="가벼움">
            <div class="label">가벼움</div>
            <div class="track">
                <div class="bar" data-value="1.3"><span class="val"></span></div>
            </div>
            <div class="right-val"></div>
        </div>
        <div class="row" data-name="밀착력">
            <div class="label">밀착력</div>
            <div class="track">
                <div class="bar" data-value="0.8"><span class="val"></span></div>
            </div>
            <div class="right-val"></div>
        </div>
        <!-- 반올림 시 0.00% → 비노출 되는 케이스 예시 -->
        <div class="row" data-name="극소값 예시(비노출)">
            <div class="label">극소값 예시(비노출)</div>
            <div class="track">
                <div class="bar" data-value="0.0047"><span class="val"></span></div>
            </div>
            <div class="right-val"></div>
        </div>
        <div class="footnote">* 이 차트 내부에서만 MAX를 100%로 두고 상대 비율로 스케일링합니다.</div>
    </div>

    <h2>부정 키워드 (영역별 MAX 기준 자동 스케일링)</h2>
    <div class="chart" data-variant="neg" id="chart-neg">
        <div class="row" data-name="끈적임">
            <div class="label">끈적임</div>
            <div class="track">
                <div class="bar" data-value="0.9"><span class="val"></span></div>
            </div>
            <div class="right-val"></div>
        </div>
        <div class="row" data-name="향">
            <div class="label">향</div>
            <div class="track">
                <div class="bar" data-value="0.2"><span class="val"></span></div>
            </div>
            <div class="right-val"></div>
        </div>
        <div class="row" data-name="가격">
            <div class="label">가격</div>
            <div class="track">
                <div class="bar" data-value="0.6"><span class="val"></span></div>
            </div>
            <div class="right-val"></div>
        </div>
        <div class="footnote">* 이 차트 내부에서만 MAX를 100%로 두고 상대 비율로 스케일링합니다.</div>
    </div>

    <script>
        /**
         * 옵션 (필요에 따라 바꿔 쓰세요)
         * DECIMALS: 표시 소수 자릿수
         * HIDE_ZERO_AFTER_ROUND: 반올림 결과가 0.00%면 해당 항목 비노출
         * MIN_VISUAL_PERCENT: 0이 아닌 값에 대해 최소 시각 폭(%)을 보장하고 싶으면 설정 (예: 2)
         */
        const DECIMALS = 2;
        const HIDE_ZERO_AFTER_ROUND = true;
        const MIN_VISUAL_PERCENT = 0; // 예: 2 로 두면 아주 작은 값도 최소 2% 폭으로 보임

        function formatPercent(val) {
            return `${val.toFixed(DECIMALS)}%`;
        }

        function buildChart(chartEl) {
            const rows = Array.from(chartEl.querySelectorAll('.row'));
            // 1) 값/반올림 계산
            const entries = rows.map(row => {
                const bar = row.querySelector('.bar');
                const raw = Number(bar?.dataset.value ?? 0);
                const rounded = Number(raw.toFixed(DECIMALS));
                return { row, bar, raw, rounded };
            });

            // 2) (선택) 반올림 결과 0.00%면 비노출
            const visible = entries.filter(e => {
                if (!HIDE_ZERO_AFTER_ROUND) return true;
                return e.rounded > 0;
            });

            // 모두 사라지면 빈 메시지
            if (visible.length === 0) {
                chartEl.innerHTML = '<div class="empty">표시할 데이터가 없습니다.</div>';
                return;
            }

            // 3) 영역 내 MAX 기준으로 상대 스케일 계산
            const max = Math.max(...visible.map(e => e.raw), 0);

            visible.forEach(e => {
                // width 계산 (영역 내 상대값)
                const w = max > 0 ? (e.raw / max) * 100 : 0;
                const wClamped = e.raw > 0 ? Math.max(w, MIN_VISUAL_PERCENT) : 0;

                e.bar.style.width = `${wClamped}%`;
                const valSpan = e.bar.querySelector('.val');
                const rightVal = e.row.querySelector('.right-val');

                // 바 내부 텍스트 & 오른쪽 정량값 동시 표시
                valSpan.textContent = formatPercent(e.rounded);
                rightVal.textContent = formatPercent(e.rounded);
            });

            // 4) 0.00% 비노출 처리된 행 제거
            entries.forEach(e => {
                if (HIDE_ZERO_AFTER_ROUND && e.rounded === 0) {
                    e.row.remove();
                }
            });
        }

        // 모든 차트에 적용
        document.querySelectorAll('.chart').forEach(buildChart);
    </script>
</body>

</html>